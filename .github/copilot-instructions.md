# Daily Report Helper – AI Guide

- Stack & shape: Tauri v2 desktop app with React 19 + TypeScript + Zustand + Tailwind on the frontend; Rust backend with Tauri commands + SQLx over SQLite. Data is stored under the app config dir (see src-tauri/src/database.rs), not in the repo.
- Key flows (frontend): App boot calls loadTodayRecords/loadApiConfig from [src/App.tsx](src/App.tsx) via Zustand store in [src/store.ts](src/store.ts). Left nav in [src/components/LeftNav.tsx](src/components/LeftNav.tsx) switches `currentView`. Main panels are Ideas, Tasks, Settings, AI chat.
- State/actions (Zustand): [src/store.ts](src/store.ts) exposes addIdea/addTask/loadTodayRecords/loadApiConfig/saveApiConfig/sendMessage/generateReport. All persistence/AI calls go through Tauri `invoke` commands. Messages are kept in memory only.
- Data model: Type shapes live in [src/types.ts](src/types.ts). Ideas and tasks carry attachment paths (string array) and timestamps; today records are grouped as `ideas` and `tasks`.
- UI patterns: IdeasView/TasksView ([src/components/IdeasView.tsx](src/components/IdeasView.tsx), [src/components/TasksView.tsx](src/components/TasksView.tsx)) load records on mount, gate empty submissions, and allow image previews via `file://` paths. Time inputs in TasksView are merged into Date objects, with cross-day handling if end < start. SettingsView ([src/components/SettingsView.tsx](src/components/SettingsView.tsx)) edits API URL/key/model and writes through the store. AIChat ([src/components/AIChat.tsx](src/components/AIChat.tsx)) shows chat history, generates daily report, and clears messages.
- Backend commands: Registered in [src-tauri/src/lib.rs](src-tauri/src/lib.rs) and implemented in [src-tauri/src/commands.rs](src-tauri/src/commands.rs). Available invocations: save_api_config, get_api_config, add_idea, add_done_task, get_today_records, generate_daily_report, send_ai_message.
- Database layer: [src-tauri/src/database.rs](src-tauri/src/database.rs) initializes a SQLite pool at `<app_config_dir>/data.db`, creates tables/config indices, and exposes a shared DbState pool. Commands create tables defensively before inserts/queries.
- Persistence schema: configs(key,value,created_at), ideas(content, attachments JSON string, created_at, date), done_tasks(content, start/end time, attachments JSON string, created_at, date). Dates stored as local time strings ("%Y-%m-%d"), times as "%Y-%m-%d %H:%M:%S".
- AI integration: send_ai_message posts to `{api_url}/chat/completions` with a fixed system prompt and non-streaming response; generate_daily_report builds a prompt from today’s ideas/tasks then calls send_ai_message. Network uses reqwest with Bearer auth.
- Known pitfall: save_api_config currently stores the *value* as the key, but get_api_config expects keys `api_key`/`api_url`/`model`; config persistence will fail unless keys are corrected. Align both sides if you touch config logic.
- Build/dev: install deps with `pnpm install` (frontend) and `cd src-tauri && cargo fetch` (Rust). Dev run `pnpm tauri dev`; production build `pnpm tauri build`. Requires Node 18+, Rust 1.75+, Tauri CLI v2.
- Styling: Tailwind utility classes plus a few custom classes (see src/index.css, src/App.css). Keep components functional and lean; avoid className regressions.
- File I/O: Plugins tauri_plugin_fs and tauri_plugin_opener are enabled; attachments are stored via paths but not uploaded.
- When adding commands: wire through generate_handler! in [src-tauri/src/lib.rs](src-tauri/src/lib.rs), expose via store invoke, and mirror types in [src/types.ts](src/types.ts) as needed.
- Diagnostics: DB init and table creation run at app startup; errors print to stdout/stderr. Frontend swallows most errors with alerts—surface actionable errors when debugging.
